<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YLC 2026 Attendance | FEBIAS College of Bible</title>

<link rel="icon" href="logo.ico">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;800&display=swap" rel="stylesheet">

<style>
body {
  font-family: "Segoe UI", system-ui, sans-serif;
  background: #f8f8f8;
  color: #1f2937;
  line-height: 1.5;
  padding: 2rem;
}

h1 { text-align: center; color: #0b3d2e; margin-bottom: 2rem; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 2rem;
}

th, td {
  border: 1px solid #ccc;
  padding: 0.8rem;
  text-align: left;
}

th {
  background: #0b3d2e;
  color: #fff;
}

.status-paid { color: green; font-weight: bold; }
.status-onsite { color: orange; font-weight: bold; }
.status-not { color: red; font-weight: bold; }

.attendance-check { cursor: pointer; text-align: center; }
</style>
</head>
<body>

<h1>YLC 2026 Attendance</h1>
<p>Check the boxes to confirm camper attendance. Payment status is shown with symbols.</p>

<table id="attendance-table">
  <thead>
    <tr>
      <th>First Name</th>
      <th>Last Name</th>
      <th>Payment Status</th>
      <th>Attendance</th>
    </tr>
  </thead>
  <tbody>
    <!-- Rows will load dynamically -->
  </tbody>
</table>

<script>
// Load data from Google Sheets Web App JSON endpoint
const sheetUrl = "https://script.google.com/macros/s/AKfycbz6LxN00Az00c3VfsGDDrXDu2m4cJmZjcjMGKGnIHQtMaWbS-9ZbAniI8K1xyZFgkB8/exec"; // replace with your endpoint

async function loadAttendance() {
  const tbody = document.querySelector("#attendance-table tbody");
  tbody.innerHTML = "";

  try {
    const res = await fetch(sheetUrl);
    const data = await res.json(); // Expect array of objects: {first_name, last_name, payment_status, attended_status}

    data.forEach(person => {
      const tr = document.createElement("tr");

      // First Name
      const tdFirst = document.createElement("td");
      tdFirst.textContent = person.first_name || "";
      tr.appendChild(tdFirst);

      // Last Name
      const tdLast = document.createElement("td");
      tdLast.textContent = person.last_name || "";
      tr.appendChild(tdLast);

      // Payment Status with symbol
      const tdPayment = document.createElement("td");
      if(person.payment_status.toLowerCase() === "online payment") {
        tdPayment.textContent = "✅ Online";
        tdPayment.className = "status-paid";
      } else if(person.payment_status.toLowerCase() === "onsite payment") {
        tdPayment.textContent = "⚠️ Onsite";
        tdPayment.className = "status-onsite";
      } else {
        tdPayment.textContent = "❌ Not Paid";
        tdPayment.className = "status-not";
      }
      tr.appendChild(tdPayment);

      // Attendance checkbox
      const tdAttend = document.createElement("td");
      tdAttend.className = "attendance-check";
      tdAttend.textContent = person.attended_status === "Arrived" ? "✅" : "⚠️";
      tdAttend.addEventListener("click", async () => {
        // Toggle attendance
        tdAttend.textContent = tdAttend.textContent === "✅" ? "⚠️" : "✅";

        // Optional: Send update to Apps Script
        await fetch(sheetUrl + "?action=markAttendance&id=" + person.rowId + "&status=" + (tdAttend.textContent === "✅" ? "Arrived" : "Not Arrived"));
      });
      tr.appendChild(tdAttend);

      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error("Failed to load attendance:", err);
    tbody.innerHTML = "<tr><td colspan='4'>Failed to load data.</td></tr>";
  }
}

// Initial load
loadAttendance();
</script>

</body>
</html>
